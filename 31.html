
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹åºœè£…é¥°è®¾è®¡æœ‰é™å…¬å¸ - æ´»åŠ¨ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #1e88e5 0%, #0d47a1 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .clock {
            font-size: 18px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 15px;
            border-radius: 30px;
            font-weight: bold;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }
        
        .btn-score {
            background: linear-gradient(90deg, #9c27b0 0%, #673ab7 100%);
            color: white;
        }
        
        .btn-redeem {
            background: linear-gradient(90deg, #e91e63 0%, #c2185b 100%);
            color: white;
        }
        
        .btn-rank {
            background: linear-gradient(90deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .btn-call {
            background: linear-gradient(90deg, #2196F3 0%, #0D47A1 100%);
            color: white;
        }
        
        .btn-visit {
            background: linear-gradient(90deg, #FF9800 0%, #EF6C00 100%);
            color: white;
        }
        
        .btn-contract {
            background: linear-gradient(90deg, #009688 0%, #00796b 100%);
            color: white;
        }
        
        .btn-deduct {
            background: linear-gradient(90deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }
        
        .tabs {
            display: flex;
            background: #f0f8ff;
            padding: 0 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: bold;
            color: #555;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab.active {
            color: #1e88e5;
            border-bottom: 3px solid #1e88e5;
            background: rgba(30, 136, 229, 0.05);
        }
        
        .tab[data-tab="contract"] {
            background: linear-gradient(90deg, #009688 0%, #00796b 100%);
            color: white;
        }
        
        .tab[data-tab="contract"].active {
            color: #009688;
            border-bottom: 3px solid #009688;
            background: rgba(0, 150, 136, 0.05);
        }
        
        .tab-content {
            padding: 20px;
            min-height: 500px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .ranking-table th {
            background: linear-gradient(90deg, #1e88e5 0%, #0d47a1 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 16px;
        }
        
        .ranking-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .ranking-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .ranking-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .ranking-table .rank-1 {
            background: linear-gradient(90deg, #fff8e1 0%, #ffecb3 100%);
            font-size: 18px;
            font-weight: bold;
        }
        
        .ranking-table .rank-2 {
            background: linear-gradient(90deg, #f5f5f5 0%, #e0e0e0 100%);
            font-size: 16px;
        }
        
        .ranking-table .rank-3 {
            background: linear-gradient(90deg, #ffecb3 0%, #ffd54f 100%);
            font-size: 16px;
        }
        
        .medal {
            font-size: 24px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .chart-container {
            margin-top: 30px;
            position: relative;
            height: 400px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #1e88e5;
            color: white;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(90deg, #1e88e5 0%, #0d47a1 100%);
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }
        
        .form-group select, 
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .rules {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .rules h3 {
            margin-bottom: 10px;
            color: #0d47a1;
        }
        
        .rules ul {
            padding-left: 20px;
        }
        
        .rules li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: #4caf50;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .deduct-reason {
            margin-top: 15px;
        }
        
        .password-field {
            margin-top: 15px;
        }
        
        .clock-container {
            position: absolute;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
        }
        
        .stats-summary {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card {
            text-align: center;
            padding: 15px;
            min-width: 200px;
        }
        
        .stat-card h3 {
            font-size: 16px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #1e88e5;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .btn {
                flex: 1;
                min-width: 140px;
                justify-content: center;
            }
            
            .stats-summary {
                flex-wrap: wrap;
            }
            
            .stat-card {
                min-width: 150px;
                margin: 0 10px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="title">ç‹‚æ¬¢ä¸€ï¼ˆå¤ï¼‰ï¼Œä¼˜æƒ å½“'ç‡ƒ' æ´»åŠ¨ç§¯åˆ†æ’è¡Œæ¦œ</div>
            <div class="clock" id="clock">2023-07-23 14:30:45</div>
        </header>
        
        <div class="stats-summary">
            <div class="stat-card">
                <h3>æ€»è¿›åº—é‡</h3>
                <div class="value" id="totalVisits">0</div>
            </div>
            <div class="stat-card">
                <h3>æ€»ç­¾å•é‡</h3>
                <div class="value" id="totalContracts">0</div>
            </div>
            <div class="stat-card">
                <h3>æ€»ç§¯åˆ†</h3>
                <div class="value" id="totalScores">0</div>
            </div>
            <div class="stat-card">
                <h3>æ€»é‡‘å¸</h3>
                <div class="value" id="totalCoins">0</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-rank" onclick="switchTab('score')">
                    <i class="fas fa-trophy"></i> ç§¯åˆ†æ’è¡Œæ¦œ
                </button>
                <button class="btn btn-call" onclick="switchTab('call')">
                    <i class="fas fa-phone"></i> ç”µè¯é‡æ’è¡Œæ¦œ
                </button>
                <button class="btn btn-visit" onclick="switchTab('visit')">
                    <i class="fas fa-store"></i> è¿›åº—é‡æ’è¡Œæ¦œ
                </button>
                <button class="btn btn-contract" onclick="switchTab('contract')">
                    <i class="fas fa-file-contract"></i> ç­¾å•æ’è¡Œæ¦œ
                </button>
            </div>
            <div class="btn-group">
                <button class="btn btn-score" onclick="openAddScoreModal('add')">
                    <i class="fas fa-plus-circle"></i> æ·»åŠ ç§¯åˆ†
                </button>
                <button class="btn btn-deduct" onclick="openAddScoreModal('deduct')">
                    <i class="fas fa-minus-circle"></i> æ‰£é™¤ç§¯åˆ†
                </button>
                <button class="btn btn-redeem" onclick="openRedeemModal()">
                    <i class="fas fa-coins"></i> å…‘æ¢é‡‘å¸
                </button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="score">ç§¯åˆ†æ’è¡Œæ¦œ</div>
            <div class="tab" data-tab="call">ç”µè¯é‡æ’è¡Œæ¦œ</div>
            <div class="tab" data-tab="visit">è¿›åº—é‡æ’è¡Œæ¦œ</div>
            <div class="tab" data-tab="contract">ç­¾å•æ’è¡Œæ¦œ</div>
        </div>
        
        <div class="tab-content">
            <!-- ç§¯åˆ†æ’è¡Œæ¦œ -->
            <div class="tab-pane active" id="score-pane">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="15%">æ’å</th>
                            <th width="35%">å§“å</th>
                            <th width="20%">ç§¯åˆ†</th>
                            <th width="20%">é‡‘å¸</th>
                        </tr>
                    </thead>
                    <tbody id="score-ranking">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <div class="action-buttons">
                    <button class="btn btn-rank" onclick="exportChart('score')">
                        <i class="fas fa-download"></i> å¯¼å‡ºç§¯åˆ†æ’è¡Œæ¦œå›¾ç‰‡
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="score-chart"></canvas>
                </div>
            </div>
            
            <!-- ç”µè¯é‡æ’è¡Œæ¦œ -->
            <div class="tab-pane" id="call-pane">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="15%">æ’å</th>
                            <th width="35%">å§“å</th>
                            <th width="50%">ç”µè¯é‡</th>
                        </tr>
                    </thead>
                    <tbody id="call-ranking">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <div class="action-buttons">
                    <button class="btn btn-call" onclick="exportChart('call')">
                        <i class="fas fa-download"></i> å¯¼å‡ºç”µè¯é‡æ’è¡Œæ¦œå›¾ç‰‡
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="call-chart"></canvas>
                </div>
            </div>
            
            <!-- è¿›åº—é‡æ’è¡Œæ¦œ -->
            <div class="tab-pane" id="visit-pane">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="15%">æ’å</th>
                            <th width="25%">å§“å</th>
                            <th width="20%">æ€»è¿›åº—é‡</th>
                            <th width="20%">ä¸€è®¿æ¬¡æ•°</th>
                            <th width="20%">äºŒè®¿æ¬¡æ•°</th>
                        </tr>
                    </thead>
                    <tbody id="visit-ranking">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <div class="action-buttons">
                    <button class="btn btn-visit" onclick="exportChart('visit')">
                        <i class="fas fa-download"></i> å¯¼å‡ºè¿›åº—é‡æ’è¡Œæ¦œå›¾ç‰‡
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="visit-chart"></canvas>
                </div>
            </div>
            
            <!-- ç­¾å•æ’è¡Œæ¦œ -->
            <div class="tab-pane" id="contract-pane">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="15%">æ’å</th>
                            <th width="35%">å§“å</th>
                            <th width="25%">ç­¾å•æ€»æ•°</th>
                            <th width="25%">é‡‘å¸</th>
                        </tr>
                    </thead>
                    <tbody id="contract-ranking">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                
                <div class="action-buttons">
                    <button class="btn btn-contract" onclick="exportChart('contract')">
                        <i class="fas fa-download"></i> å¯¼å‡ºç­¾å•æ’è¡Œæ¦œå›¾ç‰‡
                    </button>
                </div>
                
                <div class="chart-container">
                    <canvas id="contract-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="rules">
            <h3><i class="fas fa-info-circle"></i> ç§¯åˆ†è§„åˆ™è¯´æ˜</h3>
            <ul>
                <li><strong>è¿›åº—ä¸€è®¿å®¢æˆ·</strong>ï¼š+30 åˆ†</li>
                <li><strong>äºŒè®¿å®¢æˆ·</strong>ï¼š+10 åˆ†</li>
                <li><strong>æ¥æºæ–¹ç­¾å•</strong>ï¼š+300 åˆ†</li>
                <li><strong>ç­¾å•æ‰‹ç­¾å•</strong>ï¼š+200 åˆ†</li>
                <li><strong>æŠ–éŸ³æ’­æ”¾é‡æœ€é«˜</strong>ï¼šæ¯æ—¥ +10 åˆ†</li>
                <li><strong>å•æ—¥æœ€é«˜ç§¯åˆ†</strong>ï¼šé¢å¤– +5 åˆ†</li>
                <li><strong>ç§¯åˆ†å…‘æ¢</strong>ï¼š1ç§¯åˆ† = 1é‡‘å¸ = 1äººæ°‘å¸</li>
                <li><strong>å…‘æ¢è§„åˆ™</strong>ï¼šå…‘æ¢æ—¶åªå‡å°‘é‡‘å¸ï¼Œä¸å½±å“ç§¯åˆ†ã€‚é‡‘å¸ä¸è¶³100ä¸å¯å…‘æ¢ï¼Œè¶…è¿‡550åˆ†ä»¥ä¸Šå¯äº«å—1:1.1å€å…‘æ¢é‡‘å¸</li>
            </ul>
        </div>
        
        <footer>
            ç‹åºœè£…é¥°è®¾è®¡æœ‰é™å…¬å¸ Â© 2023 | æ´»åŠ¨ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ v2.0
        </footer>
    </div>
    
    <!-- æ·»åŠ /æ‰£é™¤ç§¯åˆ†æ¨¡æ€æ¡† -->
    <div class="modal" id="addScoreModal">
        <div class="modal-content">
            <div class="modal-header" id="scoreModalHeader">æ·»åŠ ç§¯åˆ†</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="employee">é€‰æ‹©å‘˜å·¥</label>
                    <select id="employee">
                        <option value="ç‹èŠ³">ç‹èŠ³</option>
                        <option value="æ¨è“‰">æ¨è“‰</option>
                        <option value="å‘¨å›½">å‘¨å›½</option>
                        <option value="é»„æ˜æ˜">é»„æ˜æ˜</option>
                        <option value="åˆ˜é“æš">åˆ˜é“æš</option>
                        <option value="é»„è¿œæŒ¯">é»„è¿œæŒ¯</option>
                        <option value="é»„ç”œç”œ">é»„ç”œç”œ</option>
                        <option value="å­™æ–‡éœ">å­™æ–‡éœ</option>
                        <option value="è´ºç§‹èŠ">è´ºç§‹èŠ</option>
                        <option value="é»„å¨œ">é»„å¨œ</option>
                        <option value="åˆ˜ç¨‹">åˆ˜ç¨‹</option>
                        <option value="ç‹é”¦æ³‰">ç‹é”¦æ³‰</option>
                        <option value="ç”°æ°¸è´¤">ç”°æ°¸è´¤</option>
                        <option value="é»„æ™“å¿ ">é»„æ™“å¿ </option>
                        <option value="èˆ’è¾¾å‹‡">èˆ’è¾¾å‹‡</option>
                        <option value="å¤ä¿®å‰">å¤ä¿®å‰</option>
                        <option value="é»„æ˜¥">é»„æ˜¥</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="scoreType">ç§¯åˆ†ç±»å‹</label>
                    <select id="scoreType">
                        <option value="ä¸€è®¿">ä¸€è®¿è¿›åº—</option>
                        <option value="äºŒè®¿">äºŒè®¿è¿›åº—</option>
                        <option value="æ¥æºæ–¹ç­¾å•">æ¥æºæ–¹ç­¾å•</option>
                        <option value="ç­¾å•æ‰‹ç­¾å•">ç­¾å•æ‰‹ç­¾å•</option>
                        <option value="æŠ–éŸ³æ’­æ”¾é‡">æŠ–éŸ³æ’­æ”¾é‡</option>
                        <option value="å•æ—¥æœ€é«˜ç§¯åˆ†">å•æ—¥æœ€é«˜ç§¯åˆ†</option>
                        <option value="ç”µè¯é‡">ç”µè¯é‡</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="quantity">æ•°é‡</label>
                    <input type="number" id="quantity" min="-100" value="1">
                </div>
                
                <div class="form-group">
                    <label for="scoreDate">æ—¥æœŸ</label>
                    <input type="date" id="scoreDate">
                </div>
                
                <div class="password-field" id="passwordField">
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    </div>
                </div>
                
                <div class="deduct-reason" id="deductReasonGroup">
                    <div class="form-group">
                        <label for="reason">æ‰£é™¤åŸå› </label>
                        <textarea id="reason" placeholder="è¯·è¯¦ç»†è¯´æ˜æ‰£é™¤ç§¯åˆ†çš„åŸå› ..." rows="3"></textarea>
                    </div>
                </div>
                
                <div class="rules">
                    <h3><i class="fas fa-exclamation-circle"></i> æ“ä½œè¯´æ˜</h3>
                    <p>åªæœ‰è¿è¥æ€»ç›‘å¯ä»¥æ·»åŠ æˆ–æ‰£é™¤ç§¯åˆ†ï¼Œè¯·ç¡®ä¿è¾“å…¥æ­£ç¡®çš„å¯†ç ã€‚</p>
                    <p>æ‰£é™¤ç§¯åˆ†éœ€è¦å¡«å†™è¯¦ç»†åŸå› ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—ã€‚</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('addScoreModal')" style="background: #f5f5f5;">å–æ¶ˆ</button>
                <button class="btn btn-score" id="scoreActionBtn" onclick="addScore()">ç¡®è®¤æ“ä½œ</button>
            </div>
        </div>
    </div>
    
    <!-- å…‘æ¢é‡‘å¸æ¨¡æ€æ¡† -->
    <div class="modal" id="redeemModal">
        <div class="modal-content">
            <div class="modal-header">å…‘æ¢é‡‘å¸</div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="redeemEmployee">é€‰æ‹©å‘˜å·¥</label>
                    <select id="redeemEmployee">
                        <option value="ç‹èŠ³">ç‹èŠ³</option>
                        <option value="æ¨è“‰">æ¨è“‰</option>
                        <option value="å‘¨å›½">å‘¨å›½</option>
                        <option value="é»„æ˜æ˜">é»„æ˜æ˜</option>
                        <option value="åˆ˜é“æš">åˆ˜é“æš</option>
                        <option value="é»„è¿œæŒ¯">é»„è¿œæŒ¯</option>
                        <option value="é»„ç”œç”œ">é»„ç”œç”œ</option>
                        <option value="å­™æ–‡éœ">å­™æ–‡éœ</option>
                        <option value="è´ºç§‹èŠ">è´ºç§‹èŠ</option>
                        <option value="é»„å¨œ">é»„å¨œ</option>
                        <option value="åˆ˜ç¨‹">åˆ˜ç¨‹</option>
                        <option value="ç‹é”¦æ³‰">ç‹é”¦æ³‰</option>
                        <option value="ç”°æ°¸è´¤">ç”°æ°¸è´¤</option>
                        <option value="é»„æ™“å¿ ">é»„æ™“å¿ </option>
                        <option value="èˆ’è¾¾å‹‡">èˆ’è¾¾å‹‡</option>
                        <option value="å¤ä¿®å‰">å¤ä¿®å‰</option>
                        <option value="é»„æ˜¥">é»„æ˜¥</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="amount">å…‘æ¢é‡‘å¸æ•°é‡</label>
                    <input type="number" id="amount" min="1" placeholder="è¯·è¾“å…¥å…‘æ¢æ•°é‡">
                </div>
                
                <div class="form-group">
                    <label for="redeemPassword">å¯†ç </label>
                    <input type="password" id="redeemPassword" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                
                <div class="rules">
                    <h3><i class="fas fa-exclamation-circle"></i> å…‘æ¢è§„åˆ™</h3>
                    <ul>
                        <li>1ç§¯åˆ† = 1é‡‘å¸ = 1äººæ°‘å¸</li>
                        <li>å…‘æ¢æ—¶åªå‡å°‘é‡‘å¸ï¼Œä¸å½±å“ç§¯åˆ†</li>
                        <li>å…‘æ¢æ•°é‡ä¸èƒ½è¶…è¿‡å½“å‰é‡‘å¸ä½™é¢</li>
                        <li>é‡‘å¸ä¸è¶³100ä¸å¯å…‘æ¢</li>
                        <li>è¶…è¿‡550åˆ†ä»¥ä¸Šå¯äº«å—1:1.1å€å…‘æ¢é‡‘å¸</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('redeemModal')" style="background: #f5f5f5;">å–æ¶ˆ</button>
                <button class="btn btn-redeem" onclick="redeemCoins()">ç¡®è®¤å…‘æ¢</button>
            </div>
        </div>
    </div>
    
    <!-- æ“ä½œé€šçŸ¥ -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">æ“ä½œæˆåŠŸï¼</span>
    </div>

    <script>
        // å‘˜å·¥æ•°æ®
        const employees = [
            "ç‹èŠ³", "æ¨è“‰", "å‘¨å›½", "é»„æ˜æ˜", "åˆ˜é“æš", "é»„è¿œæŒ¯", "é»„ç”œç”œ", 
            "å­™æ–‡éœ", "è´ºç§‹èŠ", "é»„å¨œ", "åˆ˜ç¨‹", "ç‹é”¦æ³‰", "ç”°æ°¸è´¤", 
            "é»„æ™“å¿ ", "èˆ’è¾¾å‹‡", "å¤ä¿®å‰", "é»„æ˜¥"
        ];
        
        // åˆå§‹æ•°æ®
        let employeeData = {};
        let currentActionType = "add"; // å½“å‰æ“ä½œç±»å‹ï¼šadd æˆ– deduct
        let lastPasswordTime = 0; // ä¸Šæ¬¡è¾“å…¥å¯†ç çš„æ—¶é—´
        
        // ç§¯åˆ†è§„åˆ™
        const scoreRules = {
            "ä¸€è®¿": 30,
            "äºŒè®¿": 10,
            "æ¥æºæ–¹ç­¾å•": 300,
            "ç­¾å•æ‰‹ç­¾å•": 200,
            "æŠ–éŸ³æ’­æ”¾é‡": 10,
            "å•æ—¥æœ€é«˜ç§¯åˆ†": 5
        };
        
        // å¯†ç 
        const PASSWORD = "2403";
        
        // å›¾è¡¨å®ä¾‹
        let scoreChart, callChart, visitChart, contractChart;
        
        // æ“ä½œæ—¥å¿—
        let operationLogs = [];
        
        // åˆå§‹åŒ–æ•°æ®
        function initData() {
            const savedData = localStorage.getItem('employeeData');
            if (savedData) {
                try {
                    employeeData = JSON.parse(savedData);
                } catch (e) {
                    console.error("è§£æå‘˜å·¥æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹æ•°æ®", e);
                    resetToInitialData();
                }
            } else {
                resetToInitialData();
            }
            
            // åˆå§‹åŒ–æ“ä½œæ—¥å¿—
            const savedLogs = localStorage.getItem('operationLogs');
            if (savedLogs) {
                try {
                    operationLogs = JSON.parse(savedLogs);
                } catch (e) {
                    console.error("è§£ææ“ä½œæ—¥å¿—å¤±è´¥ï¼Œé‡ç½®æ—¥å¿—", e);
                    operationLogs = [];
                }
            }
            
            // è®¾ç½®å½“å‰æ—¥æœŸ
            document.getElementById('scoreDate').valueAsDate = new Date();
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats();
        }
        
        // é‡ç½®ä¸ºåˆå§‹æ•°æ®
        function resetToInitialData() {
            employees.forEach(name => {
                employeeData[name] = {
                    score: Math.floor(Math.random() * 1000) + 500,
                    coins: Math.floor(Math.random() * 800) + 300,
                    visit1: Math.floor(Math.random() * 20) + 5,
                    visit2: Math.floor(Math.random() * 15) + 3,
                    sourceSign: Math.floor(Math.random() * 5) + 1,
                    signerSign: Math.floor(Math.random() * 8) + 2,
                    calls: Math.floor(Math.random() * 50) + 20,
                    contractPlayCount: Math.floor(Math.random() * 10),
                    totalVisits: 0,
                    totalContracts: 0
                };
            });
            saveData();
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            try {
                localStorage.setItem('employeeData', JSON.stringify(employeeData));
                localStorage.setItem('operationLogs', JSON.stringify(operationLogs));
                return true;
            } catch (e) {
                console.error("æ•°æ®ä¿å­˜å¤±è´¥:", e);
                showNotification("æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨æƒé™ï¼", true);
                return false;
            }
        }
        
        // æ›´æ–°å®æ—¶æ—¶é’Ÿ
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            const timeStr = now.toLocaleTimeString('zh-CN');
            document.getElementById('clock').textContent = `${dateStr} ${timeStr}`;
            setTimeout(updateClock, 1000);
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // æ›´æ–°æ ‡ç­¾
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabId}-pane`).classList.add('active');
            
            // æ›´æ–°å›¾è¡¨
            updateCharts();
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            let totalVisits = 0;
            let totalContracts = 0;
            let totalScores = 0;
            let totalCoins = 0;
            
            employees.forEach(name => {
                totalVisits += employeeData[name].visit1 + employeeData[name].visit2;
                totalContracts += employeeData[name].sourceSign + employeeData[name].signerSign;
                totalScores += employeeData[name].score;
                totalCoins += employeeData[name].coins;
            });
            
            document.getElementById('totalVisits').textContent = totalVisits;
            document.getElementById('totalContracts').textContent = totalContracts;
            document.getElementById('totalScores').textContent = totalScores;
            document.getElementById('totalCoins').textContent = totalCoins;
        }
        
        // ç”Ÿæˆæ’è¡Œæ¦œ
        function generateRankings() {
            // ç§¯åˆ†æ’è¡Œæ¦œ
            generateScoreRanking();
            
            // ç”µè¯é‡æ’è¡Œæ¦œ
            generateCallRanking();
            
            // è¿›åº—é‡æ’è¡Œæ¦œ
            generateVisitRanking();
            
            // ç­¾å•æ’è¡Œæ¦œ
            generateContractRanking();
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats();
        }
        
        // ç”Ÿæˆç§¯åˆ†æ’è¡Œæ¦œ
        function generateScoreRanking() {
            const tbody = document.getElementById('score-ranking');
            tbody.innerHTML = '';
            
            // å‡†å¤‡æ•°æ®å¹¶æ’åº
            const rankingData = employees.map(name => ({
                name,
                score: employeeData[name].score,
                coins: employeeData[name].coins
            })).sort((a, b) => b.score - a.score);
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            rankingData.forEach((emp, index) => {
                const row = document.createElement('tr');
                
                // æ·»åŠ æ’åæ ·å¼
                if (index === 0) row.className = 'rank-1';
                else if (index === 1) row.className = 'rank-2';
                else if (index === 2) row.className = 'rank-3';
                
                // æ’ååˆ—
                const rankCell = document.createElement('td');
                if (index === 0) rankCell.innerHTML = '<span class="medal">ğŸ¥‡</span> 1';
                else if (index === 1) rankCell.innerHTML = '<span class="medal">ğŸ¥ˆ</span> 2';
                else if (index === 2) rankCell.innerHTML = '<span class="medal">ğŸ¥‰</span> 3';
                else rankCell.textContent = index + 1;
                
                // å§“ååˆ—
                const nameCell = document.createElement('td');
                nameCell.textContent = emp.name;
                
                // ç§¯åˆ†åˆ—
                const scoreCell = document.createElement('td');
                scoreCell.textContent = emp.score;
                
                // é‡‘å¸åˆ—
                const coinsCell = document.createElement('td');
                coinsCell.textContent = emp.coins;
                
                row.appendChild(rankCell);
                row.appendChild(nameCell);
                row.appendChild(scoreCell);
                row.appendChild(coinsCell);
                tbody.appendChild(row);
            });
        }
        
        // ç”Ÿæˆç”µè¯é‡æ’è¡Œæ¦œ
        function generateCallRanking() {
            const tbody = document.getElementById('call-ranking');
            tbody.innerHTML = '';
            
            // å‡†å¤‡æ•°æ®å¹¶æ’åº
            const rankingData = employees.map(name => ({
                name,
                calls: employeeData[name].calls
            })).sort((a, b) => b.calls - a.calls);
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            rankingData.forEach((emp, index) => {
                const row = document.createElement('tr');
                
                // æ·»åŠ æ’åæ ·å¼
                if (index === 0) row.className = 'rank-1';
                else if (index === 1) row.className = 'rank-2';
                else if (index === 2) row.className = 'rank-3';
                
                // æ’ååˆ—
                const rankCell = document.createElement('td');
                if (index === 0) rankCell.innerHTML = '<span class="medal">ğŸ¥‡</span> 1';
                else if (index === 1) rankCell.innerHTML = '<span class="medal">ğŸ¥ˆ</span> 2';
                else if (index === 2) rankCell.innerHTML = '<span class="medal">ğŸ¥‰</span> 3';
                else rankCell.textContent = index + 1;
                
                // å§“ååˆ—
                const nameCell = document.createElement('td');
                nameCell.textContent = emp.name;
                
                // ç”µè¯é‡åˆ—
                const callsCell = document.createElement('td');
                callsCell.textContent = emp.calls;
                
                row.appendChild(rankCell);
                row.appendChild(nameCell);
                row.appendChild(callsCell);
                tbody.appendChild(row);
            });
        }
        
        // ç”Ÿæˆè¿›åº—é‡æ’è¡Œæ¦œ
        function generateVisitRanking() {
            const tbody = document.getElementById('visit-ranking');
            tbody.innerHTML = '';
            
            // å‡†å¤‡æ•°æ®å¹¶æ’åº
            const rankingData = employees.map(name => ({
                name,
                visits: employeeData[name].visit1 + employeeData[name].visit2,
                visit1: employeeData[name].visit1,
                visit2: employeeData[name].visit2
            })).sort((a, b) => b.visits - a.visits);
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            rankingData.forEach((emp, index) => {
                const row = document.createElement('tr');
                
                // æ·»åŠ æ’åæ ·å¼
                if (index === 0) row.className = 'rank-1';
                else if (index === 1) row.className = 'rank-2';
                else if (index === 2) row.className = 'rank-3';
                
                // æ’ååˆ—
                const rankCell = document.createElement('td');
                if (index === 0) rankCell.innerHTML = '<span class="medal">ğŸ¥‡</span> 1';
                else if (index === 1) rankCell.innerHTML = '<span class="medal">ğŸ¥ˆ</span> 2';
                else if (index === 2) rankCell.innerHTML = '<span class="medal">ğŸ¥‰</span> 3';
                else rankCell.textContent = index + 1;
                
                // å§“ååˆ—
                const nameCell = document.createElement('td');
                nameCell.textContent = emp.name;
                
                // æ€»è¿›åº—é‡åˆ—
                const visitsCell = document.createElement('td');
                visitsCell.textContent = emp.visits;
                
                // ä¸€è®¿åˆ—
                const visit1Cell = document.createElement('td');
                visit1Cell.textContent = emp.visit1;
                
                // äºŒè®¿åˆ—
                const visit2Cell = document.createElement('td');
                visit2Cell.textContent = emp.visit2;
                
                row.appendChild(rankCell);
                row.appendChild(nameCell);
                row.appendChild(visitsCell);
                row.appendChild(visit1Cell);
                row.appendChild(visit2Cell);
                tbody.appendChild(row);
            });
        }
        
        // ç”Ÿæˆç­¾å•æ’è¡Œæ¦œ
        function generateContractRanking() {
            const tbody = document.getElementById('contract-ranking');
            tbody.innerHTML = '';
            
            // è®¡ç®—ç­¾å•æ€»æ•° (æ¥æºæ–¹ç­¾å• + ç­¾å•æ‰‹ç­¾å•)
            const rankingData = employees.map(name => ({
                name,
                contracts: employeeData[name].sourceSign + employeeData[name].signerSign,
                coins: employeeData[name].coins
            })).sort((a, b) => b.contracts - a.contracts);
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            rankingData.forEach((emp, index) => {
                const row = document.createElement('tr');
                
                // æ·»åŠ æ’åæ ·å¼
                if (index === 0) row.className = 'rank-1';
                else if (index === 1) row.className = 'rank-2';
                else if (index === 2) row.className = 'rank-3';
                
                // æ’ååˆ—
                const rankCell = document.createElement('td');
                if (index === 0) rankCell.innerHTML = '<span class="medal">ğŸ¥‡</span> 1';
                else if (index === 1) rankCell.innerHTML = '<span class="medal">ğŸ¥ˆ</span> 2';
                else if (index === 2) rankCell.innerHTML = '<span class="medal">ğŸ¥‰</span> 3';
                else rankCell.textContent = index + 1;
                
                // å§“ååˆ—
                const nameCell = document.createElement('td');
                nameCell.textContent = emp.name;
                
                // ç­¾å•æ€»æ•°åˆ—
                const contractsCell = document.createElement('td');
                contractsCell.textContent = emp.contracts;
                
                // é‡‘å¸åˆ—
                const coinsCell = document.createElement('td');
                coinsCell.textContent = emp.coins;
                
                row.appendChild(rankCell);
                row.appendChild(nameCell);
                row.appendChild(contractsCell);
                row.appendChild(coinsCell);
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            updateScoreChart();
            updateCallChart();
            updateVisitChart();
            updateContractChart();
        }
        
        // æ›´æ–°ç§¯åˆ†å›¾è¡¨
        function updateScoreChart() {
            const ctx = document.getElementById('score-chart').getContext('2d');
            
            // å‡†å¤‡æ•°æ®
            const rankingData = employees.map(name => ({
                name,
                score: employeeData[name].score
            })).sort((a, b) => b.score - a.score).slice(0, 10);
            
            const labels = rankingData.map(emp => emp.name);
            const data = rankingData.map(emp => emp.score);
            
            if (scoreChart) {
                scoreChart.destroy();
            }
            
            scoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç§¯åˆ†',
                        data: data,
                        backgroundColor: '#1e88e5',
                        borderColor: '#0d47a1',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç§¯åˆ†æ’è¡Œæ¦œ TOP10',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§¯åˆ†'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°ç”µè¯é‡å›¾è¡¨
        function updateCallChart() {
            const ctx = document.getElementById('call-chart').getContext('2d');
            
            // å‡†å¤‡æ•°æ®
            const rankingData = employees.map(name => ({
                name,
                calls: employeeData[name].calls
            })).sort((a, b) => b.calls - a.calls).slice(0, 10);
            
            const labels = rankingData.map(emp => emp.name);
            const data = rankingData.map(emp => emp.calls);
            
            if (callChart) {
                callChart.destroy();
            }
            
            callChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç”µè¯é‡',
                        data: data,
                        backgroundColor: '#2196F3',
                        borderColor: '#0D47A1',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç”µè¯é‡æ’è¡Œæ¦œ TOP10',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç”µè¯é‡'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°è¿›åº—é‡å›¾è¡¨
        function updateVisitChart() {
            const ctx = document.getElementById('visit-chart').getContext('2d');
            
            // å‡†å¤‡æ•°æ®
            const rankingData = employees.map(name => ({
                name,
                visits: employeeData[name].visit1 + employeeData[name].visit2,
                visit1: employeeData[name].visit1,
                visit2: employeeData[name].visit2
            })).sort((a, b) => b.visits - a.visits).slice(0, 10);
            
            const labels = rankingData.map(emp => emp.name);
            const visit1Data = rankingData.map(emp => emp.visit1);
            const visit2Data = rankingData.map(emp => emp.visit2);
            
            if (visitChart) {
                visitChart.destroy();
            }
            
            visitChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ä¸€è®¿',
                            data: visit1Data,
                            backgroundColor: '#FF9800'
                        },
                        {
                            label: 'äºŒè®¿',
                            data: visit2Data,
                            backgroundColor: '#FF5722'
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'è¿›åº—é‡æ’è¡Œæ¦œ TOP10',
                            font: {
                                size: 18
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'è¿›åº—é‡'
                            }
                        },
                        y: {
                            stacked: true
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°ç­¾å•å›¾è¡¨
        function updateContractChart() {
            const ctx = document.getElementById('contract-chart').getContext('2d');
            
            // è®¡ç®—ç­¾å•æ€»æ•° (æ¥æºæ–¹ç­¾å• + ç­¾å•æ‰‹ç­¾å•)
            const rankingData = employees.map(name => ({
                name,
                contracts: employeeData[name].sourceSign + employeeData[name].signerSign
            })).sort((a, b) => b.contracts - a.contracts).slice(0, 10);
            
            const labels = rankingData.map(emp => emp.name);
            const data = rankingData.map(emp => emp.contracts);
            
            if (contractChart) {
                contractChart.destroy();
            }
            
            contractChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ç­¾å•æ€»æ•°',
                        data: data,
                        backgroundColor: '#009688',
                        borderColor: '#00796b',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç­¾å•æ’è¡Œæ¦œ TOP10',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç­¾å•æ€»æ•°'
                            }
                        }
                    }
                }
            });
        }
        
        // æ‰“å¼€æ·»åŠ /æ‰£é™¤ç§¯åˆ†æ¨¡æ€æ¡†
        function openAddScoreModal(actionType) {
            currentActionType = actionType;
            
            const modal = document.getElementById('addScoreModal');
            const header = document.getElementById('scoreModalHeader');
            const actionBtn = document.getElementById('scoreActionBtn');
            const reasonGroup = document.getElementById('deductReasonGroup');
            const passwordField = document.getElementById('passwordField');
            
            if (actionType === 'add') {
                header.textContent = 'æ·»åŠ ç§¯åˆ†/ç”µè¯é‡';
                actionBtn.textContent = 'ç¡®è®¤æ·»åŠ ';
                actionBtn.className = 'btn btn-score';
                reasonGroup.style.display = 'none';
            } else {
                header.textContent = 'æ‰£é™¤ç§¯åˆ†';
                actionBtn.textContent = 'ç¡®è®¤æ‰£é™¤';
                actionBtn.className = 'btn btn-deduct';
                reasonGroup.style.display = 'block';
            }
            
            passwordField.style.display = 'block';
            modal.style.display = 'flex';
        }
        
        // æ‰“å¼€å…‘æ¢é‡‘å¸æ¨¡æ€æ¡†
        function openRedeemModal() {
            document.getElementById('redeemModal').style.display = 'flex';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // æ·»åŠ æˆ–æ‰£é™¤ç§¯åˆ†
        function addScore() {
            const employee = document.getElementById('employee').value;
            const scoreType = document.getElementById('scoreType').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const password = document.getElementById('password').value;
            const reason = document.getElementById('reason').value;
            const scoreDate = document.getElementById('scoreDate').value;
            
            // éªŒè¯åŸºç¡€è¾“å…¥
            if (!employee || !scoreType) {
                showNotification('è¯·é€‰æ‹©å‘˜å·¥å’Œç§¯åˆ†ç±»å‹ï¼', true);
                return;
            }
            
            // éªŒè¯å¯†ç 
            const now = new Date().getTime();
            if (password !== PASSWORD) {
                showNotification('å¯†ç é”™è¯¯ï¼', true);
                return;
            }
            
            // å¯†ç äº”åˆ†é’Ÿæœ‰æ•ˆ
            if (now - lastPasswordTime > 5 * 60 * 1000) {
                showNotification('å¯†ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è¾“å…¥ï¼', true);
                return;
            }
            lastPasswordTime = now;
            
            // éªŒè¯æ•°é‡
            if (isNaN(quantity)) {
                showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡ï¼', true);
                return;
            }
            
            if (currentActionType === 'deduct' && !reason.trim()) {
                showNotification('è¯·å¡«å†™æ‰£é™¤åŸå› ï¼', true);
                return;
            }
            
            // æ ¹æ®ç±»å‹å¤„ç†æ•°æ®ä¿®æ”¹
            try {
                if (scoreType === 'æŠ–éŸ³æ’­æ”¾é‡') {
                    // æŠ–éŸ³æ’­æ”¾é‡ç‰¹æ®Šå¤„ç†ï¼ˆæ¯å¤©ä»…ä¸€æ¬¡ï¼‰
                    if (scoreDate !== new Date().toISOString().split('T')[0]) {
                        employeeData[employee].contractPlayCount = 0;
                    }
                    
                    if (quantity > 0) {
                        employeeData[employee].contractPlayCount += quantity;
                        employeeData[employee].score += quantity * scoreRules['æŠ–éŸ³æ’­æ”¾é‡'];
                        employeeData[employee].coins += quantity * scoreRules['æŠ–éŸ³æ’­æ”¾é‡'];
                    } else {
                        employeeData[employee].contractPlayCount = Math.max(0, employeeData[employee].contractPlayCount - quantity);
                        employeeData[employee].score -= quantity * scoreRules['æŠ–éŸ³æ’­æ”¾é‡'];
                        employeeData[employee].coins -= quantity * scoreRules['æŠ–éŸ³æ’­æ”¾é‡'];
                    }
                } 
                else if (scoreType === 'å•æ—¥æœ€é«˜ç§¯åˆ†') {
                    // å•æ—¥æœ€é«˜ç§¯åˆ†ç‰¹æ®Šå¤„ç†
                    if (quantity > 0) {
                        employeeData[employee].score += scoreRules['å•æ—¥æœ€é«˜ç§¯åˆ†'];
                        employeeData[employee].coins += scoreRules['å•æ—¥æœ€é«˜ç§¯åˆ†'];
                    } else {
                        employeeData[employee].score -= scoreRules['å•æ—¥æœ€é«˜ç§¯åˆ†'];
                        employeeData[employee].coins -= scoreRules['å•æ—¥æœ€é«˜ç§¯åˆ†'];
                    }
                } 
                else if (scoreType === 'ç”µè¯é‡') {
                    // ç”µè¯é‡ç›´æ¥åŠ å‡
                    employeeData[employee].calls += quantity;
                    // ç¡®ä¿ç”µè¯é‡ä¸ä½äº0
                    employeeData[employee].calls = Math.max(0, employeeData[employee].calls);
                } 
                else {
                    // å…¶ä»–ç§¯åˆ†ç±»å‹
                    let pointsPerItem = 0;
                    
                    if (scoreType === 'ä¸€è®¿') pointsPerItem = scoreRules['ä¸€è®¿'];
                    else if (scoreType === 'äºŒè®¿') pointsPerItem = scoreRules['äºŒè®¿'];
                    else if (scoreType === 'æ¥æºæ–¹ç­¾å•') pointsPerItem = scoreRules['æ¥æºæ–¹ç­¾å•'];
                    else if (scoreType === 'ç­¾å•æ‰‹ç­¾å•') pointsPerItem = scoreRules['ç­¾å•æ‰‹ç­¾å•'];
                    
                    const pointsToAdjust = pointsPerItem * quantity;
                    
                    if (currentActionType === 'add') {
                        // æ·»åŠ ç§¯åˆ†
                        if (scoreType === 'ä¸€è®¿') {
                            employeeData[employee].visit1 += quantity;
                        } 
                        else if (scoreType === 'äºŒè®¿') {
                            employeeData[employee].visit2 += quantity;
                        }
                        else if (scoreType === 'æ¥æºæ–¹ç­¾å•') {
                            employeeData[employee].sourceSign += quantity;
                        }
                        else if (scoreType === 'ç­¾å•æ‰‹ç­¾å•') {
                            employeeData[employee].signerSign += quantity;
                        }
                        
                        employeeData[employee].score += pointsToAdjust;
                        employeeData[employee].coins += pointsToAdjust;
                    } else {
                        // æ‰£é™¤ç§¯åˆ†
                        if (employeeData[employee].score < pointsToAdjust || 
                            employeeData[employee].coins < pointsToAdjust) {
                            showNotification(`æ‰£é™¤å¤±è´¥ï¼${employee}çš„ç§¯åˆ†æˆ–é‡‘å¸ä¸è¶³ã€‚`, true);
                            return;
                        }
                        
                        if (scoreType === 'ä¸€è®¿') {
                            employeeData[employee].visit1 = Math.max(0, employeeData[employee].visit1 - quantity);
                        } 
                        else if (scoreType === 'äºŒè®¿') {
                            employeeData[employee].visit2 = Math.max(0, employeeData[employee].visit2 - quantity);
                        }
                        else if (scoreType === 'æ¥æºæ–¹ç­¾å•') {
                            employeeData[employee].sourceSign = Math.max(0, employeeData[employee].sourceSign - quantity);
                        }
                        else if (scoreType === 'ç­¾å•æ‰‹ç­¾å•') {
                            employeeData[employee].signerSign = Math.max(0, employeeData[employee].signerSign - quantity);
                        }
                        
                        employeeData[employee].score -= pointsToAdjust;
                        employeeData[employee].coins -= pointsToAdjust;
                        
                        // è®°å½•æ“ä½œæ—¥å¿—
                        operationLogs.push({
                            type: 'æ‰£é™¤ç§¯åˆ†',
                            employee,
                            amount: pointsToAdjust,
                            reason,
                            timestamp: new Date().toISOString()
                        });
                    }
                }
                
                // ä¿å­˜æ•°æ®å¹¶æ›´æ–°ç•Œé¢
                if (saveData()) {
                    generateRankings();
                    updateCharts();
                    closeModal('addScoreModal');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('quantity').value = 1;
                    document.getElementById('password').value = '';
                    document.getElementById('reason').value = '';
                    
                    showNotification('æ•°æ®ä¿®æ”¹æˆåŠŸï¼');
                } else {
                    showNotification('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', true);
                }
            } catch (e) {
                console.error("æ•°æ®ä¿®æ”¹é”™è¯¯:", e);
                showNotification('ç³»ç»Ÿé”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼', true);
            }
        }
        
        // å…‘æ¢é‡‘å¸
        function redeemCoins() {
            const employee = document.getElementById('redeemEmployee').value;
            const amount = parseInt(document.getElementById('amount').value);
            const password = document.getElementById('redeemPassword').value;
            
            // éªŒè¯åŸºç¡€è¾“å…¥
            if (!employee || isNaN(amount)) {
                showNotification('è¯·é€‰æ‹©å‘˜å·¥å’Œæœ‰æ•ˆå…‘æ¢æ•°é‡ï¼', true);
                return;
            }
            
            // éªŒè¯å¯†ç 
            if (password !== PASSWORD) {
                showNotification('å¯†ç é”™è¯¯ï¼', true);
                return;
            }
            
            // å¯†ç äº”åˆ†é’Ÿæœ‰æ•ˆ
            const now = new Date().getTime();
            if (now - lastPasswordTime > 5 * 60 * 1000) {
                showNotification('å¯†ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°è¾“å…¥ï¼', true);
                return;
            }
            lastPasswordTime = now;
            
            // éªŒè¯é‡‘å¸ä½™é¢
            if (employeeData[employee].coins < amount) {
                showNotification(`é‡‘å¸ä¸è¶³ï¼å½“å‰é‡‘å¸ä½™é¢: ${employeeData[employee].coins}`, true);
                return;
            }
            
            // ä¸æ»¡100é‡‘å¸ä¸å¯å…‘æ¢
            if (employeeData[employee].coins < 100) {
                showNotification('é‡‘å¸ä¸è¶³100ï¼Œæ— æ³•å…‘æ¢ï¼', true);
                return;
            }
            
            // å…‘æ¢é‡‘å¸ï¼ˆä»…å‡å°‘é‡‘å¸ï¼Œä¸å½±å“ç§¯åˆ†ï¼‰
            employeeData[employee].coins -= amount;
            
            // ä¿å­˜æ•°æ®å¹¶æ›´æ–°ç•Œé¢
            if (saveData()) {
                generateRankings();
                updateCharts();
                closeModal('redeemModal');
                
                // æ¸…ç©ºè¡¨å•
                document.getElementById('amount').value = '';
                document.getElementById('redeemPassword').value = '';
                
                showNotification(`å·²ä¸º ${employee} å…‘æ¢ ${amount} é‡‘å¸ï¼`);
            } else {
                showNotification('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', true);
            }
        }
        
        // å¯¼å‡ºå›¾è¡¨
        function exportChart(type) {
            let chart, fileName;
            
            switch (type) {
                case 'score':
                    chart = scoreChart;
                    fileName = 'ç§¯åˆ†æ’è¡Œæ¦œ.png';
                    break;
                case 'call':
                    chart = callChart;
                    fileName = 'ç”µè¯é‡æ’è¡Œæ¦œ.png';
                    break;
                case 'visit':
                    chart = visitChart;
                    fileName = 'è¿›åº—é‡æ’è¡Œæ¦œ.png';
                    break;
                case 'contract':
                    chart = contractChart;
                    fileName = 'ç­¾å•æ’è¡Œæ¦œ.png';
                    break;
                default:
                    return;
            }
            
            if (!chart) {
                showNotification('å›¾è¡¨å°šæœªç”Ÿæˆï¼', true);
                return;
            }
            
            // åˆ›å»ºä¸´æ—¶é“¾æ¥
            const link = document.createElement('a');
            link.href = chart.toBase64Image();
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`å·²å¯¼å‡º ${fileName} å›¾ç‰‡ï¼`);
        }
        
        // æ˜¾ç¤ºæ“ä½œé€šçŸ¥
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = 'notification';
            
            if (isError) {
                notification.classList.add('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            initData();
            updateClock();
            generateRankings();
            updateCharts();
            
            // æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            document.getElementById('scoreDate').valueAsDate = new Date();
            
            // å¯†ç è¾“å…¥äº‹ä»¶ï¼Œè®°å½•æœ€åä¸€æ¬¡è¾“å…¥å¯†ç çš„æ—¶é—´
            document.getElementById('password').addEventListener('input', function() {
                lastPasswordTime = new Date().getTime();
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
